<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ram Assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.box{
  background:rgba(0,0,0,0.45);
  padding:25px;
  border-radius:16px;
  width:90%;
  max-width:420px;
  text-align:center;
}
button{
  margin-top:18px;
  padding:14px 28px;
  font-size:18px;
  border:none;
  border-radius:30px;
  background:#00ffcc;
  color:#000;
}
.status{font-size:13px;opacity:.85}
#text{margin-top:15px;min-height:40px}
</style>
</head>

<body>
<div class="box">
  <h2>ðŸŽ™ Ram Assistant</h2>
  <div class="status">Tap and say "Hey Ram"</div>
  <button onclick="startListening()">ðŸŽ¤ Speak</button>
  <div id="text"></div>
</div>

<script>
/* ---------- SPEECH ---------- */
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.lang = "en-IN";
recognition.interimResults = false;
recognition.continuous = false;

/* ---------- STATE ---------- */
let state = "idle"; // idle | awake | answering
let voiceReady = false;

/* ---------- VOICE ---------- */
function initVoice(){
  if(voiceReady) return;
  speechSynthesis.getVoices();
  voiceReady = true;
}

function speak(text, lang="en-IN"){
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  u.rate = lang === "te-IN" ? 0.9 : 1;
  speechSynthesis.speak(u);
}

/* ---------- START ---------- */
function startListening(){
  initVoice();
  document.querySelector(".status").innerText = "Say 'Hey Ram'";
  try{ recognition.start(); }catch{}
}

/* ---------- RESULT ---------- */
recognition.onresult = e => {
  const text = e.results[0][0].transcript.toLowerCase();
  document.getElementById("text").innerText = "You: " + text;

  if(state === "idle"){
    if(text.includes("hey ram")){
      state = "awake";
      speak("Cheppandi nenu vintunnanu", "te-IN");
      document.querySelector(".status").innerText = "Listening...";
    }
    return;
  }

  if(state === "awake"){
    state = "answering";
    document.querySelector(".status").innerText = "Thinking...";
    handleCommand(text);
  }
};

/* ---------- AUTO RESTART ---------- */
recognition.onend = () => {
  if(state !== "answering"){
    setTimeout(()=>{ try{recognition.start()}catch{} }, 600);
  }
};

/* ---------- COMMANDS ---------- */
function handleCommand(text){
  const isTelugu = /[\u0C00-\u0C7F]/.test(text);

  if(text.includes("time") || text.includes("samayam")){
    speak(
      isTelugu ? "Ippudu samayam " + new Date().toLocaleTimeString()
               : "Current time is " + new Date().toLocaleTimeString(),
      isTelugu ? "te-IN" : "en-IN"
    );
    reset(); return;
  }

  if(text.includes("joke")){
    const jokes = [
      "Why did the computer go to the doctor? Because it caught a virus.",
      "Why was the computer cold? Because it forgot to close Windows.",
      "Why did the keyboard break up? Too many arguments."
    ];
    speak(jokes[Math.floor(Math.random()*jokes.length)], "en-IN");
    reset(); return;
  }
if(text.includes("news")){
  speak("Fetching news");
  getLatestNews(text);
  return;
}
  speak(isTelugu ? "Ardham kale" : "I did not understand", isTelugu?"te-IN":"en-IN");
  reset();
}

  async function getLatestNews(query){
  let topic = "top";
  let speakPrefix = "Latest news.";

  if(query.includes("stock") || query.includes("market") || query.includes("share")){
    topic = "business";
    speakPrefix = "Latest stock market news.";
  }
  else if(query.includes("politic") || query.includes("government") || query.includes("election")){
    topic = "politics";
    speakPrefix = "Latest political news.";
  }
  else if(query.includes("sport") || query.includes("cricket") || query.includes("ipl")){
    topic = "sports";
    speakPrefix = "Latest sports news.";
  }
  else if(query.includes("tech") || query.includes("ai") || query.includes("mobile")){
    topic = "technology";
    speakPrefix = "Latest technology news.";
  }

  try{
    const rssMap = {
      top: "https://news.google.com/rss?hl=en-IN&gl=IN&ceid=IN:en",
      business: "https://news.google.com/rss/headlines/section/topic/BUSINESS?hl=en-IN&gl=IN&ceid=IN:en",
      politics: "https://news.google.com/rss/headlines/section/topic/POLITICS?hl=en-IN&gl=IN&ceid=IN:en",
      sports: "https://news.google.com/rss/headlines/section/topic/SPORTS?hl=en-IN&gl=IN&ceid=IN:en",
      technology: "https://news.google.com/rss/headlines/section/topic/TECHNOLOGY?hl=en-IN&gl=IN&ceid=IN:en"
    };

    const url =
      "https://api.rss2json.com/v1/api.json?rss_url=" +
      encodeURIComponent(rssMap[topic]);

    const res = await fetch(url);
    const data = await res.json();

    if(data.items && data.items.length > 0){
      speak(speakPrefix + " " + data.items[0].title, "en-IN");
    } else {
      speak("Sorry, no related news found right now");
    }

  } catch {
    speak("Unable to fetch related news now");
  }

  reset();
}

/* ---------- RESET ---------- */
function reset(){
  state = "idle";
  document.querySelector(".status").innerText = "Say 'Hey Ram'";
}
</script>
</body>
</html>
