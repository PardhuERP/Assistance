<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ram Assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.box{
  background:rgba(0,0,0,0.45);
  padding:25px;
  border-radius:16px;
  width:90%;
  max-width:420px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
}
h2{
  margin:0 0 10px;
  font-size:22px;
}
.status{
  font-size:13px;
  opacity:0.85;
}
button{
  margin-top:18px;
  padding:14px 28px;
  font-size:18px;
  border:none;
  border-radius:30px;
  background:#00ffcc;
  color:#000;
  cursor:pointer;
}
button:active{
  transform:scale(0.97);
}
#text{
  margin-top:18px;
  min-height:42px;
  font-size:15px;
  line-height:1.4;
}
.footer{
  margin-top:15px;
  font-size:11px;
  opacity:0.6;
}
</style>
</head>

<body>

<div class="box">
  <h2>ðŸŽ™ Ram Assistant</h2>
  <div class="status">Tap and speak</div>
  <button onclick="startListening()">ðŸŽ¤ Speak</button>
  <div id="text"></div>
  <div class="footer">AI powered voice assistant</div>
</div>

<script>
/* ---------- SPEECH RECOGNITION ---------- */
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

const recognition = new SpeechRecognition();
recognition.lang = "en-IN";
recognition.interimResults = false;
recognition.continuous = false;

/* ---------- STATE ---------- */
let isAwake = false;
let voiceReady = false;

/* ---------- VOICE INIT ---------- */
function initVoice(){
  if(voiceReady) return;
  speechSynthesis.getVoices();
  voiceReady = true;
}

/* ---------- SPEAK ---------- */
function speak(msg, lang="en-IN"){
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(msg);
  u.lang = lang;
  u.rate = 1;
  speechSynthesis.speak(u);
}

/* ---------- START LISTEN ---------- */
function startListening(){
  initVoice();
  document.querySelector(".status").innerText = "Listening for 'Hey Ram'...";
  recognition.start();
}

/* ---------- RESULT ---------- */
recognition.onresult = function(e){
  const text = e.results[0][0].transcript.toLowerCase();
  document.getElementById("text").innerText = "You: " + text;

  // ðŸŸ¢ WAKE WORD
  if(!isAwake){
  if(text.includes("hey ram")){
    isAwake = true;
    speak("Cheppandi, nenu vintunnanu", "te-IN");
    document.querySelector(".status").innerText = "Listening...";

    // ðŸ” RESTART LISTENING FOR NEXT QUESTION
    recognition.stop();
    setTimeout(() => {
      recognition.start();
    }, 800);
  } else {
    document.querySelector(".status").innerText = "Say 'Hey Ram'";
  }
  return;
}

  // ðŸŸ¢ HANDLE COMMAND AFTER WAKE
  document.querySelector(".status").innerText = "Thinking...";
  handleCommand(text);
};

/* ---------- ERROR ---------- */
recognition.onerror = function(){
  document.querySelector(".status").innerText = "Tap and speak";
};

/* ---------- COMMAND HANDLER ---------- */
function handleCommand(text){

  // Telugu detection (simple)
  const isTelugu = /[\u0C00-\u0C7F]/.test(text);

  // Local commands
  if(text.includes("time") || text.includes("samayam")){
    speak(
      isTelugu ? 
      "Ippudu samayam " + new Date().toLocaleTimeString() :
      "Current time is " + new Date().toLocaleTimeString(),
      isTelugu ? "te-IN" : "en-IN"
    );
    reset();
    return;
  }

  if(text.includes("joke") || text.includes("jok")) {
    speak(
      isTelugu ?
      "Computer doctor daggariki enduku vellindi ante, virus pattindani." :
      "Why did the computer go to the doctor? Because it caught a virus.",
      isTelugu ? "te-IN" : "en-IN"
    );
    reset();
    return;
  }

  if(text.includes("thank") || text.includes("dhanyavadalu")){
    speak(
      isTelugu ? "Mee ku swagatham" : "You are welcome",
      isTelugu ? "te-IN" : "en-IN"
    );
    reset();
    return;
  }

  // Fallback to worker (FREE brain)
  askAI(text, isTelugu);
}

/* ---------- FREE WORKER CALL ---------- */
async function askAI(question, isTelugu){
  try{
    const response = await fetch(
      "https://morning-block-a72d.valentin-ch5.workers.dev",
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ message: question })
      }
    );

    const data = await response.json();

    speak(
      data.reply || "Sorry, ardham kale",
      isTelugu ? "te-IN" : "en-IN"
    );

  }catch{
    speak(
      isTelugu ? "Network samasya undi" : "Network error",
      isTelugu ? "te-IN" : "en-IN"
    );
  }

  reset();
}

/* ---------- RESET ---------- */
function reset(){
  isAwake = false;
  document.querySelector(".status").innerText = "Say 'Hey Ram'";
}
</script>

</body>
</html>
