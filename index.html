<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ram Assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.box{
  background:rgba(0,0,0,0.45);
  padding:25px;
  border-radius:16px;
  width:90%;
  max-width:420px;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
}
h2{
  margin:0 0 10px;
  font-size:22px;
}
.status{
  font-size:13px;
  opacity:0.85;
}
button{
  margin-top:18px;
  padding:14px 28px;
  font-size:18px;
  border:none;
  border-radius:30px;
  background:#00ffcc;
  color:#000;
  cursor:pointer;
}
button:active{
  transform:scale(0.97);
}
#text{
  margin-top:18px;
  min-height:42px;
  font-size:15px;
  line-height:1.4;
}
.footer{
  margin-top:15px;
  font-size:11px;
  opacity:0.6;
}
</style>
</head>

<body>

<div class="box">
  <h2>ðŸŽ™ Ram Assistant</h2>
  <div class="status">Tap and speak</div>
  <button onclick="startListening()">ðŸŽ¤ Speak</button>
  <div id="text"></div>
  <div class="footer">AI powered voice assistant</div>
</div>

<script>
/* ---------- SPEECH RECOGNITION ---------- */
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

const recognition = new SpeechRecognition();
recognition.lang = "en-IN";
recognition.interimResults = false;

/* ---------- SPEECH SYNTHESIS ---------- */
let voiceReady = false;

function initVoice(){
  if(voiceReady) return;
  speechSynthesis.getVoices();
  voiceReady = true;
}

function speak(msg){
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(msg);
  u.lang = "en-IN";
  u.rate = 1;
  u.pitch = 1;
  speechSynthesis.speak(u);
}

/* ---------- START LISTEN ---------- */
function startListening(){
  initVoice();
  document.querySelector(".status").innerText = "Listening...";
  recognition.start();
}

/* ---------- RESULT ---------- */
recognition.onresult = function(e){
  const text = e.results[0][0].transcript.toLowerCase();
  document.getElementById("text").innerText = "You: " + text;
  document.querySelector(".status").innerText = "Thinking...";
  handleCommand(text);
};

recognition.onerror = function(){
  speak("Sorry, I didn't catch that");
  document.querySelector(".status").innerText = "Tap and speak";
};

/* ---------- COMMAND HANDLER ---------- */
function handleCommand(text){

  // Local fast commands
  if(text.includes("open google")){
    speak("Opening Google");
    window.open("https://google.com","_blank");
    resetStatus();
    return;
  }

  if(text.includes("open youtube")){
    speak("Opening YouTube");
    window.open("https://youtube.com","_blank");
    resetStatus();
    return;
  }

  if(text.includes("time")){
    speak("Current time is " + new Date().toLocaleTimeString());
    resetStatus();
    return;
  }

  if(text.includes("date")){
    speak("Today is " + new Date().toDateString());
    resetStatus();
    return;
  }

  if(text.includes("who are you")){
    speak("I am Ram Assistant, your personal AI helper");
    resetStatus();
    return;
  }

  // AI fallback
  askAI(text);
}

/* ---------- AI VIA CLOUDFLARE WORKER ---------- */
async function askAI(question){
  speak("Let me think");

  try{
    const response = await fetch(
      "https://morning-block-a72d.valentin-ch5.workers.dev",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: question })
      }
    );

    const data = await response.json();

    if(data.reply){
      speak(data.reply);
    }else{
      speak("Sorry, I didn't get a response");
    }

  }catch(err){
    speak("Network error. Please try again");
  }

  resetStatus();
}

function resetStatus(){
  document.querySelector(".status").innerText = "Tap and speak";
}
</script>

</body>
</html>
